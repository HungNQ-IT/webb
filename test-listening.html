<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Listening Data</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 { color: #333; }
    pre {
      background: #f8f8f8;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      max-height: 600px;
      overflow-y: auto;
    }
    .error {
      color: red;
      background: #fee;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
    }
    .success {
      color: green;
      background: #efe;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸŽ§ Test IELTS Listening Data</h1>
    
    <div>
      <button onclick="loadData()">Load ielts.json</button>
      <button onclick="clearCache()">Clear Cache</button>
      <button onclick="testListening()">Test Listening ID 106</button>
    </div>
    
    <div id="output"></div>
  </div>

  <script>
    const output = document.getElementById('output')
    
    function log(message, type = 'info') {
      const div = document.createElement('div')
      div.className = type
      div.textContent = message
      output.appendChild(div)
    }
    
    function clearOutput() {
      output.innerHTML = ''
    }
    
    async function loadData() {
      clearOutput()
      log('ðŸ“¥ Loading ielts.json...', 'info')
      
      try {
        const response = await fetch('/ielts.json')
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`)
        }
        
        const data = await response.json()
        log(`âœ… Loaded ${data.length} tests`, 'success')
        
        // Find listening tests
        const listeningTests = data.filter(t => t.type === 'ielts-listening')
        log(`ðŸŽ§ Found ${listeningTests.length} listening tests`, 'success')
        
        listeningTests.forEach(test => {
          log(`\nðŸ“ Test ID ${test.id}: ${test.title}`, 'info')
          log(`   - Category: ${test.category}`, 'info')
          log(`   - Type: ${test.type}`, 'info')
          log(`   - Sections: ${test.sections ? test.sections.length : 'undefined'}`, 'info')
          
          if (test.sections && Array.isArray(test.sections)) {
            test.sections.forEach((section, idx) => {
              log(`   - Section ${idx + 1}: ${section.title} (${section.questions?.length || 0} questions)`, 'info')
            })
          } else {
            log(`   âš ï¸  WARNING: sections is not an array!`, 'error')
          }
        })
        
        // Display full data
        const pre = document.createElement('pre')
        pre.textContent = JSON.stringify(listeningTests, null, 2)
        output.appendChild(pre)
        
      } catch (error) {
        log(`âŒ Error: ${error.message}`, 'error')
        console.error(error)
      }
    }
    
    function clearCache() {
      clearOutput()
      localStorage.removeItem('ielts_cache')
      localStorage.removeItem('quizzes_cache')
      log('âœ… Cache cleared!', 'success')
    }
    
    async function testListening() {
      clearOutput()
      log('ðŸ§ª Testing Listening ID 106...', 'info')
      
      try {
        const response = await fetch('/ielts.json')
        const data = await response.json()
        
        const test = data.find(t => t.id === 106)
        
        if (!test) {
          log('âŒ Test ID 106 not found!', 'error')
          return
        }
        
        log(`âœ… Found test: ${test.title}`, 'success')
        log(`   - Type: ${test.type}`, 'info')
        log(`   - Category: ${test.category}`, 'info')
        
        // Check sections
        if (!test.sections) {
          log('âŒ ERROR: test.sections is undefined!', 'error')
        } else if (!Array.isArray(test.sections)) {
          log('âŒ ERROR: test.sections is not an array!', 'error')
          log(`   Type: ${typeof test.sections}`, 'error')
        } else if (test.sections.length === 0) {
          log('âŒ ERROR: test.sections is empty!', 'error')
        } else {
          log(`âœ… test.sections is valid (${test.sections.length} sections)`, 'success')
          
          test.sections.forEach((section, idx) => {
            log(`\nðŸ“‹ Section ${idx + 1}:`, 'info')
            log(`   - ID: ${section.id}`, 'info')
            log(`   - Title: ${section.title}`, 'info')
            log(`   - Questions: ${section.questions?.length || 0}`, 'info')
            
            if (section.questions && section.questions.length > 0) {
              section.questions.forEach((q, qIdx) => {
                log(`     â€¢ Question ${qIdx + 1}: ${q.type}`, 'info')
              })
            }
          })
        }
        
        // Display full test data
        const pre = document.createElement('pre')
        pre.textContent = JSON.stringify(test, null, 2)
        output.appendChild(pre)
        
      } catch (error) {
        log(`âŒ Error: ${error.message}`, 'error')
        console.error(error)
      }
    }
    
    // Auto load on page load
    window.addEventListener('load', () => {
      log('ðŸš€ Page loaded. Click "Load ielts.json" to test.', 'info')
    })
  </script>
</body>
</html>
